// File generated from our OpenAPI spec by Stainless.

package com.dodopayments.api.models.checkoutsessions

import com.dodopayments.api.core.jsonMapper
import com.dodopayments.api.models.misc.CountryCode
import com.dodopayments.api.models.misc.Currency
import com.dodopayments.api.models.misc.TaxCategory
import com.fasterxml.jackson.module.kotlin.jacksonTypeRef
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

internal class CheckoutSessionPreviewResponseTest {

    @Test
    fun create() {
        val checkoutSessionPreviewResponse =
            CheckoutSessionPreviewResponse.builder()
                .billingCountry(CountryCode.AF)
                .currency(Currency.AED)
                .currentBreakup(
                    CheckoutSessionPreviewResponse.CurrentBreakup.builder()
                        .discount(0)
                        .subtotal(0)
                        .totalAmount(0)
                        .tax(0)
                        .build()
                )
                .addProductCart(
                    CheckoutSessionPreviewResponse.ProductCart.builder()
                        .addCreditEntitlement(
                            CheckoutSessionPreviewResponse.ProductCart.CreditEntitlement.builder()
                                .creditEntitlementId("credit_entitlement_id")
                                .creditEntitlementName("credit_entitlement_name")
                                .creditEntitlementUnit("credit_entitlement_unit")
                                .creditsAmount("credits_amount")
                                .build()
                        )
                        .currency(Currency.AED)
                        .discountedPrice(0)
                        .isSubscription(true)
                        .isUsageBased(true)
                        .addMeter(
                            CheckoutSessionPreviewResponse.ProductCart.Meter.builder()
                                .measurementUnit("measurement_unit")
                                .name("name")
                                .pricePerUnit("10.50")
                                .description("description")
                                .freeThreshold(0L)
                                .build()
                        )
                        .ogCurrency(Currency.AED)
                        .ogPrice(0)
                        .productId("product_id")
                        .quantity(0)
                        .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                        .taxInclusive(true)
                        .taxRate(0)
                        .addAddon(
                            CheckoutSessionPreviewResponse.ProductCart.Addon.builder()
                                .addonId("addon_id")
                                .currency(Currency.AED)
                                .discountedPrice(0)
                                .name("name")
                                .ogCurrency(Currency.AED)
                                .ogPrice(0)
                                .quantity(0)
                                .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                                .taxInclusive(true)
                                .taxRate(0)
                                .description("description")
                                .discountAmount(0)
                                .tax(0)
                                .build()
                        )
                        .description("description")
                        .discountAmount(0)
                        .discountCycle(0)
                        .name("name")
                        .tax(0)
                        .build()
                )
                .totalPrice(0)
                .recurringBreakup(
                    CheckoutSessionPreviewResponse.RecurringBreakup.builder()
                        .discount(0)
                        .subtotal(0)
                        .totalAmount(0)
                        .tax(0)
                        .build()
                )
                .taxIdErrMsg("tax_id_err_msg")
                .totalTax(0)
                .build()

        assertThat(checkoutSessionPreviewResponse.billingCountry()).isEqualTo(CountryCode.AF)
        assertThat(checkoutSessionPreviewResponse.currency()).isEqualTo(Currency.AED)
        assertThat(checkoutSessionPreviewResponse.currentBreakup())
            .isEqualTo(
                CheckoutSessionPreviewResponse.CurrentBreakup.builder()
                    .discount(0)
                    .subtotal(0)
                    .totalAmount(0)
                    .tax(0)
                    .build()
            )
        assertThat(checkoutSessionPreviewResponse.productCart())
            .containsExactly(
                CheckoutSessionPreviewResponse.ProductCart.builder()
                    .addCreditEntitlement(
                        CheckoutSessionPreviewResponse.ProductCart.CreditEntitlement.builder()
                            .creditEntitlementId("credit_entitlement_id")
                            .creditEntitlementName("credit_entitlement_name")
                            .creditEntitlementUnit("credit_entitlement_unit")
                            .creditsAmount("credits_amount")
                            .build()
                    )
                    .currency(Currency.AED)
                    .discountedPrice(0)
                    .isSubscription(true)
                    .isUsageBased(true)
                    .addMeter(
                        CheckoutSessionPreviewResponse.ProductCart.Meter.builder()
                            .measurementUnit("measurement_unit")
                            .name("name")
                            .pricePerUnit("10.50")
                            .description("description")
                            .freeThreshold(0L)
                            .build()
                    )
                    .ogCurrency(Currency.AED)
                    .ogPrice(0)
                    .productId("product_id")
                    .quantity(0)
                    .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                    .taxInclusive(true)
                    .taxRate(0)
                    .addAddon(
                        CheckoutSessionPreviewResponse.ProductCart.Addon.builder()
                            .addonId("addon_id")
                            .currency(Currency.AED)
                            .discountedPrice(0)
                            .name("name")
                            .ogCurrency(Currency.AED)
                            .ogPrice(0)
                            .quantity(0)
                            .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                            .taxInclusive(true)
                            .taxRate(0)
                            .description("description")
                            .discountAmount(0)
                            .tax(0)
                            .build()
                    )
                    .description("description")
                    .discountAmount(0)
                    .discountCycle(0)
                    .name("name")
                    .tax(0)
                    .build()
            )
        assertThat(checkoutSessionPreviewResponse.totalPrice()).isEqualTo(0)
        assertThat(checkoutSessionPreviewResponse.recurringBreakup())
            .contains(
                CheckoutSessionPreviewResponse.RecurringBreakup.builder()
                    .discount(0)
                    .subtotal(0)
                    .totalAmount(0)
                    .tax(0)
                    .build()
            )
        assertThat(checkoutSessionPreviewResponse.taxIdErrMsg()).contains("tax_id_err_msg")
        assertThat(checkoutSessionPreviewResponse.totalTax()).contains(0)
    }

    @Test
    fun roundtrip() {
        val jsonMapper = jsonMapper()
        val checkoutSessionPreviewResponse =
            CheckoutSessionPreviewResponse.builder()
                .billingCountry(CountryCode.AF)
                .currency(Currency.AED)
                .currentBreakup(
                    CheckoutSessionPreviewResponse.CurrentBreakup.builder()
                        .discount(0)
                        .subtotal(0)
                        .totalAmount(0)
                        .tax(0)
                        .build()
                )
                .addProductCart(
                    CheckoutSessionPreviewResponse.ProductCart.builder()
                        .addCreditEntitlement(
                            CheckoutSessionPreviewResponse.ProductCart.CreditEntitlement.builder()
                                .creditEntitlementId("credit_entitlement_id")
                                .creditEntitlementName("credit_entitlement_name")
                                .creditEntitlementUnit("credit_entitlement_unit")
                                .creditsAmount("credits_amount")
                                .build()
                        )
                        .currency(Currency.AED)
                        .discountedPrice(0)
                        .isSubscription(true)
                        .isUsageBased(true)
                        .addMeter(
                            CheckoutSessionPreviewResponse.ProductCart.Meter.builder()
                                .measurementUnit("measurement_unit")
                                .name("name")
                                .pricePerUnit("10.50")
                                .description("description")
                                .freeThreshold(0L)
                                .build()
                        )
                        .ogCurrency(Currency.AED)
                        .ogPrice(0)
                        .productId("product_id")
                        .quantity(0)
                        .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                        .taxInclusive(true)
                        .taxRate(0)
                        .addAddon(
                            CheckoutSessionPreviewResponse.ProductCart.Addon.builder()
                                .addonId("addon_id")
                                .currency(Currency.AED)
                                .discountedPrice(0)
                                .name("name")
                                .ogCurrency(Currency.AED)
                                .ogPrice(0)
                                .quantity(0)
                                .taxCategory(TaxCategory.DIGITAL_PRODUCTS)
                                .taxInclusive(true)
                                .taxRate(0)
                                .description("description")
                                .discountAmount(0)
                                .tax(0)
                                .build()
                        )
                        .description("description")
                        .discountAmount(0)
                        .discountCycle(0)
                        .name("name")
                        .tax(0)
                        .build()
                )
                .totalPrice(0)
                .recurringBreakup(
                    CheckoutSessionPreviewResponse.RecurringBreakup.builder()
                        .discount(0)
                        .subtotal(0)
                        .totalAmount(0)
                        .tax(0)
                        .build()
                )
                .taxIdErrMsg("tax_id_err_msg")
                .totalTax(0)
                .build()

        val roundtrippedCheckoutSessionPreviewResponse =
            jsonMapper.readValue(
                jsonMapper.writeValueAsString(checkoutSessionPreviewResponse),
                jacksonTypeRef<CheckoutSessionPreviewResponse>(),
            )

        assertThat(roundtrippedCheckoutSessionPreviewResponse)
            .isEqualTo(checkoutSessionPreviewResponse)
    }
}
